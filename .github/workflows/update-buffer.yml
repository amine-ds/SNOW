name: Update deploy_tmp buffer

on:
  push:
    branches:
      - DEV
      - QUA
      - PRD

jobs:
  update-buffer:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Append deploy.txt to deploy_tmp.txt
      run: |
        echo "ðŸ”„ Updating deploy_tmp.txt..."

        # CrÃ©ation si n'existe pas
        touch deploy_tmp.txt

        if test -f "deploy.txt"; then
          cat deploy.txt >> deploy_tmp.txt
        fi

        # Nettoyage : remove duplicate + empty
        sort -u deploy_tmp.txt | sed '/^$/d' > deploy_tmp_clean.txt
        mv deploy_tmp_clean.txt deploy_tmp.txt

    - name: Commit buffer
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

        git add deploy_tmp.txt
        git commit -m "Update deploy_tmp buffer" || echo "No changes"
        git push
