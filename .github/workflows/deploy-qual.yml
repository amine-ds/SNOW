name: Deploy Snowflake Tables to QUAL

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install SnowSQL (Safe Linux Binary)
      run: |
        sudo apt-get update
        sudo apt-get install -y unzip
        curl -L -o snowsql.zip https://sfc-repo.snowflakecomputing.com/snowsql/linux_x86_64/snowsql-latest-linux_x86_64.zip
        unzip snowsql.zip
        sudo mv snowsql /usr/local/bin/snowsql
        chmod +x /usr/local/bin/snowsql

    - name: Deploy tables to QUAL
      env:
        SNOWSQL_PWD: ${{ secrets.SF_PASSWORD }}
      run: |
        for file in TABLE/*.sql
        do
          echo "ðŸš€ Deploying $file"
          snowsql -a ${{ secrets.SF_ACCOUNT }} \
                  -u ${{ secrets.SF_USER }} \
                  -r SYSADMIN \
                  -d QUAL_EMEA \
                  -w COMPUTE_WH \
                  -f "$file"
        done
